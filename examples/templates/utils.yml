apiVersion: frisbee.io/v1alpha1
kind: Template
metadata:
  name: utils
spec:
  services:
    iperf-server:
      ports:
        - port: 5201
          name: tcp
      image: "networkstatic/iperf3"
      args: [ "-s", "-f", "m" ]


    iperf-client:
      image: "networkstatic/iperf3"
      env:
        - name: server
          value: 127.0.0.1
      command:
        - /bin/sh # Run shell
        - -c # Read from string
        - |  # Multi-line str
          set -eum
          trap "touch /dev/shm/stop" EXIT

          sleep 10 # Wait for NIC
          iperf3 -c ${server} -t 600 -f m > /dev/shm/pipe
