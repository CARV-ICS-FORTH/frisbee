apiVersion: frisbee.io/v1alpha1
kind: Workflow
metadata:
  name: redis-experiment
spec:
  importMonitors: [ "sysmon/container", "redismon/telegraf", "ycsbmon/goycsb" ]
  ingress: platform.science-hangar.eu

  actions:
    # Create Redis nodes
    - actiontype: DistributedGroup
      name: masters
      distributedGroup:
        domain: jedi5.cluster.ics.forth.gr
        templateRef: redis/master
        instances: 1
          #inputs:
        #- { memory: 30Gi, cpu: "8" }

    # Ingest keys in parallel into different ranges
    - actiontype: DistributedGroup
      name: loaders
      depends: { running: [ masters ], duration: 30s }
      distributedGroup:
        domain: jedi6.cluster.ics.forth.gr
        templateRef: redis/loader
        inputs:
          - { server: .group.masters.any, recordcount: "5000000", offset: "0" }


    # Wait until servers are removed
    - actiontype: Wait
      name: "teardown"
      wait:
        success: [ loaders ]