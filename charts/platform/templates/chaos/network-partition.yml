---
# chaos.network.partition.namespace will separate the target service from every other service in the namespace
apiVersion: frisbee.io/v1alpha1
kind: Template
metadata:
  name: chaos.network.partition.namespace

spec:
  inputs:
    parameters:
      target: localhost
      direction: both
      duration: "2m"
  chaos:
    type: raw
    raw: |
      apiVersion: chaos-mesh.org/v1alpha1
      kind: NetworkChaos
      metadata:
        name: autogenerated
      spec:
        action: partition
        direction: {{"{{.Inputs.Parameters.direction}}" | quote}}
        duration: {{"{{.Inputs.Parameters.duration}}" | quote}}
        mode: all
        selector:
          namespaces:
            - {{.Release.Namespace}}
        target:
          mode: all
          selector:
            pods:
              {{.Release.Namespace}}:
                - {{"{{.Inputs.Parameters.target}}" | quote}}

---
# chaos.network.partition will separate the target service from every other service that exists in the given plan,
# and it is not a core frisbee service (e.g, telemetry)
#
# https://chaos-mesh.org/docs/1.0.3/user_guides/experiment_scope/
apiVersion: frisbee.io/v1alpha1
kind: Template
metadata:
  name: chaos.network.partition

spec:
  inputs:
    parameters:
      target: localhost
      direction: both
      duration: "2m"
      plan: ""
  chaos:
    type: raw
    raw: |
      apiVersion: chaos-mesh.org/v1alpha1
      kind: NetworkChaos
      metadata:
        name: autogenerated
      spec:
        action: partition
        direction: {{"{{.Inputs.Parameters.direction}}" | quote}}
        duration: {{"{{.Inputs.Parameters.duration}}" | quote}}
        mode: all
        selector:
          expressionSelectors:
            - { key: 'app.kubernetes.io/part-of', operator: In, values: [ {{"{{.Inputs.Parameters.plan}}" | quote}}] }
            - { key: 'app.kubernetes.io/component', operator: In, values: [ "SUT" ] }
        target:
          mode: all
          selector:
            pods:
              {{.Release.Namespace}}:
                - {{"{{.Inputs.Parameters.target}}" | quote}}