---
# Glue between the rbac role and the Frisbee deployment's Account.
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: frisbee
  namespace: {{.Release.Namespace}}
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: frisbee
subjects:
  - kind: ServiceAccount
    namespace: {{.Release.Namespace}}
    # If the operator runs internal to the cluster, use the frisbee account.
    # If the operator runs externally to the cluster, use the default account
    # This is because accounting requires mounting a token to the pod, which is not feasible
    # for externally running controllers.
    {{if .Values.operator.enabled}}
    name: frisbee
    {{ else }}
    name: default
    {{ end }}

---
# Default view, for where manager permissions are too permissive.
#apiVersion: rbac.authorization.k8s.io/v1
#kind: ClusterRoleBinding
#metadata:
#  name: default-view
#subjects:
#  - kind: ServiceAccount
#    name: frisbee-account
#    namespace: {{.Release.Namespace}}
#roleRef:
#  apiGroup: rbac.authorization.k8s.io
  #  kind: ClusterRole
  #  name: view