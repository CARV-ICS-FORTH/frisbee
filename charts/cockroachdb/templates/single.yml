---
apiVersion: frisbee.io/v1alpha1
kind: Template
metadata:
  name: cockroach.single.master
  labels:
    app.kubernetes.io/managed-by: {{.Release.Service | quote}}
spec:
  service:
    agents:
      telemetry: [ platform.telemetry.container, cockroachmon/server ]
    container:
      name: app
      image: cockroachdb/cockroach:latest
      ports:
        - name: to-clients
          containerPort: 26257
        - name: to-console
          containerPort: 8080
      command:
        - /bin/sh   # Run shell
        - -c        # Read from string
        - |         # Multi-line str
          set -eum
          trap "touch /dev/shm/stop" EXIT

          echo "Start Cockroachdb"
          cockroach start-single-node                   \
              --insecure                                \
              --store=$${HOSTNAME}                      \
              --listen-addr=$${HOSTNAME}:26257          \
              --http-addr=$${HOSTNAME}:8080
