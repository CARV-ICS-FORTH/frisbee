---
apiVersion: frisbee.io/v1alpha1
kind: Workflow
metadata:
  name: cockroach-baseline
spec:
  withTelemetry:
    importDashboards:
      - platform.telemetry.container
      - ycsb.telemetry.client
      - cockroach.telemetry.server

  actions:
    - action: Cluster
      name: master
      cluster:
        templateRef: cockroach.cluster.master
        instances: 3
        inputs:
          - servers: "master-1:26257,master-2:26257,master-3:26257"

    - action: Service
      name: boot
      depends:
        running: [ master ]
      service:
        templateRef: cockroach.cluster.bootstrap
        inputs:
          - server: .cluster.master.one

    - action: Service
      depends:
        success: [ boot ]
      name: loader
      service:
        templateRef: ycsb.cockroach.loader
        inputs:
          - recordcount: "1000000"
            server: .cluster.master.one
            threads: "400"
            workload: workloada


    - action: Service
      depends:
        success: [ loader ]
      name: workload-a
      service:
        templateRef: ycsb.cockroach.runner
        inputs:
          - cpu: "8"
            memory: 8Gi
            operationcount: "1000000"
            server: .cluster.master.one
            threads: "40"
            workload: workloada


    - action: Service
      depends:
        success: [ workload-a ]
      name: workload-b
      service:
        templateRef: ycsb.cockroach.runner
        inputs:
          - cpu: "8"
            memory: 8Gi
            operationcount: "1000000"
            server: .cluster.master.one
            threads: "40"
            workload: workloadb

    - action: Service
      depends:
        success: [ workload-b ]
      name: workload-c
      service:
        templateRef: ycsb.cockroach.runner
        inputs:
          - cpu: "8"
            memory: 8Gi
            operationcount: "1000000"
            server: .cluster.master.one
            threads: "40"
            workload: workloadc

    - action: Service
      depends:
        success: [ workload-c ]
      name: workload-f
      service:
        
        templateRef: ycsb.cockroach.runner
        inputs:
          - cpu: "8"
            memory: 8Gi
            operationcount: "1000000"
            server: .cluster.master.one
            threads: "40"
            workload: workloadf

    - action: Service
      depends:
        success: [ workload-f ]
      name: workload-d
      service:
        templateRef: ycsb.cockroach.runner
        inputs:
          - cpu: "8"
            memory: 8Gi
            operationcount: "1000000"
            server: .cluster.master.one
            threads: "40"
            workload: workloadd

    - action: Service
      depends:
        success: [ workload-d ]
      name: reloader
      service:
        templateRef: ycsb.cockroach.runner
        inputs:
          - dropdata: "true"
            recordcount: "1000000"
            server: .cluster.master.one
            threads: "400"
            workload: workloade

    - action: Service
      depends:
        success: [ reloader ]
      name: workload-e
      service:
        templateRef: ycsb.cockroach.runner
        inputs:
          - cpu: "8"
            memory: 8Gi
            operationcount: "1000000"
            server: .cluster.master.one
            threads: "40"
            workload: workloade
