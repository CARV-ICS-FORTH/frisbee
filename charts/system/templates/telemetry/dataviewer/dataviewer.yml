---
apiVersion: frisbee.dev/v1alpha1
kind: Template
metadata:
  name: system.telemetry.dataviewer.template
spec:
  service:
    requirements:
      ingressBackend:
        service:
          name: self
          port:
            number: {{.Values.telemetry.dataviewer.port}}

    decorators:
      labels:
        scenario.frisbee.dev/component: SYS

    # Do a nasty touch to sync/populate the volume.
    initContainers:
      - name: wait-for-volume
        image: busybox
        command: [ "touch", "/testdata/init" ]

    containers: # Expose collected logs
      - name: app
        image: filebrowser/filebrowser
        command: [ "/filebrowser" ]
        args: [ "-r", "/testdata" ]
        ports:
          - name: http
            containerPort: {{.Values.telemetry.dataviewer.port}}

    callables:
      num-of-files:
        container: app
        command:
          - /bin/sh
          - -c
          - |
            ls /testdata | wc -l

      list-files:
        container: app
        command:
          - /bin/sh
          - -c
          - |
            ls -l /testdata