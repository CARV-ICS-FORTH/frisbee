---
apiVersion: frisbee.dev/v1alpha1
kind: Template
metadata:
  name: system.telemetry.logviewer.template
spec:
  service:
    requirements:
      ingressBackend:
        service:
          name: self
          port:
            number: {{.Values.telemetry.logviewer.port}}

    decorators:
      labels:
        scenario.frisbee.dev/component: SYS

    # Do a nasty touch to sync/populate the volume.
    initContainers:
      - name: wait-for-volume
        image: busybox
        volumeMounts:
          - name: logs
            mountPath: /srv
        command: [ "touch", "/srv/init" ]

    containers: # Expose collected logs
      - name: app
        image: filebrowser/filebrowser
        ports:
          - name: http
            containerPort: {{.Values.telemetry.logviewer.port}}
        volumeMounts:
          - name: logs
            mountPath: /srv
