---
apiVersion: frisbee.io/v1alpha1
kind: Template
metadata:
  name: default.telemetry.logviewer
spec:
  inputs:
    parameters:
      logVolumeName: ""

  service:
    decorators:
      labels:
        plan.frisbee.io/component: SYS

    volumes: # Match the pod to the log volume
      - name: logs
        persistentVolumeClaim:
          claimName: {{"{{.Inputs.Parameters.logVolumeName}}" | quote}}

    # Do a nasty touch to sync/populate the volume.
    initContainers:
      - name: wait-for-volume
        image: busybox
        volumeMounts:
          - name: logs
            mountPath: /srv
        command: [ "touch", "/srv/init" ]

    containers: # Expose collected logs
      - name: filebrowser
        image: filebrowser/filebrowser
        ports:
          - name: http
            containerPort: {{.Values.telemetry.logviewerPort}}
        volumeMounts:
          - name: logs
            mountPath: /srv
